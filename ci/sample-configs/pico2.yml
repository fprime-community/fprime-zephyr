# Required by the CI system
deployment-name: ReferenceDeployment
platform-name: zephyr
test-scripts: 
  - lib/fprime/Svc/CmdDispatcher/test/int/test_cmd_dispatcher.py
  - lib/fprime/Svc/EventManager/test/int/test_cmd_eventManager.py 
# Zephyr uses custom dictionary path
dictionary: build-artifacts/zephyr/fprime-zephyr-deployment/dict/ReferenceDeploymentTopologyDictionary.json
executable: build-artifacts/zephyr.hex
archive-path: ./archive.tar.gz

extra-archive-files:
  - lib/zephyr-workspace/zephyr/boards/raspberrypi/rpi_pico2/support/openocd.cfg

extra-build-arguments:
  - --target
  - FprimeZephyrReference_ReferenceDeployment

extra-generate-arguments:
  - -DBOARD=rpi_pico2/rp2350a/m33

extra-gds-arguments:
  - --zmq-transport
  - ipc:///tmp/fprime-server-ci-in
  - ipc:///tmp/fprime-server-ci-out
  - --communication-selection
  - uart
  - --uart-baud
  - "115200"
  - --uart-device
  - /dev/ttyACM0
  - --uart-skip-port-check
  - --output-unframed-data
  - "/tmp/unframed"
  - --gui
  - none

extra-pytest-arguments:
  - -s
  - --zmq-transport
  - ipc:///tmp/fprime-server-ci-in
  - ipc:///tmp/fprime-server-ci-out
  - --deployment-config
  - FprimeZephyrReference/ReferenceDeployment/test/int/int_config.json

# Plugin CLI arguments
command-line-options:
  ci-selection: zephyr-ci-unified
  port: /dev/ttyACM0
  unframed-output: /tmp/unframed

# Plugin required keys
flash-command:
  - openocd
  - -s
  - ./openocd/tcl
  - -f
  - openocd.cfg
  - -c
  - 'source [find interface/cmsis-dap.cfg]'
  - -c
  - 'source [find target/rp2350.cfg]'
  - -c
  - 'set_adapter_speed_if_not_set 5000'
  - -c
  - init
  - -c
  - targets
  - -c
  - 'reset init'
  - -c
  - 'flash write_image erase ./build-artifacts/zephyr.hex'
  - -c
  - 'reset run'
  - -c
  - shutdown
